[
 {
  "allow_guest": 0,
  "api_method": null,
  "cron_format": null,
  "disabled": 0,
  "docstatus": 0,
  "doctype": "Server Script",
  "doctype_event": "Before Save",
  "enable_rate_limit": 0,
  "event_frequency": "All",
  "modified": "2025-10-16 19:40:38.000354",
  "module": "User Branch Control",
  "name": "strict_user_to_allowed_branch",
  "rate_limit_count": 5,
  "rate_limit_seconds": 86400,
  "reference_doctype": "Sales Invoice",
  "script": "# Script Type: DocType Event\r\n# Reference DocType: Sales Invoice\r\n# DocType Event: Before Save\r\n\r\nif doc.branch:\r\n    user = frappe.session.user\r\n    \r\n    if user != \"Administrator\":\r\n        user_branch_record = frappe.get_all(\r\n            \"user_branch_control\", # Corrected DocType Name\r\n            filters={\r\n                \"user\": user,\r\n                \"branch\": doc.branch,\r\n                \"disable_write\": 1\r\n            },\r\n            limit=1\r\n        )\r\n        \r\n        if user_branch_record:\r\n            frappe.throw(\r\n                f\"ليس لديك صلاحية الكتابة في الفرع: {doc.branch}\",\r\n                title=\"صلاحية مقيدة\"\r\n            )",
  "script_type": "DocType Event"
 }
]